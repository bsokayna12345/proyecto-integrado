{% extends 'administracion/base.html' %}
{% load static %}
{% load i18n %}

{% block title %}
  Products  
{% endblock title %}


{% block link %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
{% endblock link %}


{% block content %}
{% block cesta %}
          
{% endblock cesta %}

<form  method="post" class="form-floating" action="{% url 'administracion:producto_edit' key=form.instance.id %}">    
    {% csrf_token %} 
    <input type="hidden" name="secure_data" value="{{secure_data}}"/>      
    <div class="card mt-5">
        <h5 class="card-title">Añadir Producto:</h5>
        <div class="card-body">                    
            <div class="row">
                <div class="col-md-3">
                    <div class="form-floating">                                    
                        {{form.categoria_id}}                        
                        <label for="{{form.categoria_id.id_for_label}}">{{form.categoria_id.label}}</label>
                        <h5 class="small">{{form.categoria_id.errors}} </h5>                  
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-floating">                                    
                        {{form.subcategoria_id}}                        
                        <label for="{{form.subcategoria_id.id_for_label}}">{{form.subcategoria_id.label}}</label>
                        <h5 class="small">{{form.subcategoria_id.errors}} </h5>                  
                    </div>
                </div>
                <div class="col-md-5">
                    <div class="form-floating">
                        {{form.marca_id}}                        
                        <label for="{{form.marca_id.id_for_label}}">{{form.marca_id.label}}</label>
                        <h5 class="small">{{form.marca_id.errors}} </h5>                  
                    </div>
                </div>
            </div>
            <div class="row">                
                <div class="col-md-3">
                    <div class="form-floating">
                        {{form.nombre}}                        
                        <label for="{{form.nombre.id_for_label}}">{{form.nombre.label}}</label>
                        <h5 class="small">{{form.nombre.errors}} </h5>                  
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-floating">
                        {{form.unidades}}                        
                        <label for="{{form.unidades.id_for_label}}">{{form.unidades.label}}</label>
                        <h5 class="small">{{form.unidades.errors}} </h5>                  
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-floating">
                        {{form.precio}}                        
                        <label for="{{form.precio.id_for_label}}">{{form.precio.label}}</label>
                        <h5 class="small">{{form.precio.errors}} </h5>                  
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-floating">                                         
                        {{form.iva}}                        
                        <label for="{{form.iva.id_for_label}}">{{form.iva.label}}</label>
                        <h5 class="small">{{form.iva.errors}} </h5>                  
                    </div>
                </div>
            </div>                                  
        </div>
    </div> 
    <div class="card mt-2">                
            <div class="col-md-12">
                <div class="form-floating">                                      
                    {{form.desccripcion}}                        
                    <label for="{{form.desccripcion.id_for_label}}">{{form.desccripcion.label}}</label>
                            
                </div>
            </div>                     
    </div>
    
    {% if form.instance.id %}    
        <div class="card mt-2">                
            <div class="col-md-12 m-2">
                {% comment %} Button modal añadir imagen  {% endcomment %}
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addImagen">
                    Añadir Imagen
                </button>
            </div>
            {% comment %} imagenes {% endcomment %}
            <div class="container mt-2">
                <div class="row">      
                {% for imagen_id in qsImagenProducto %}     
                    <div class="col-md-4">
                    <a href="" style="text-decoration: none; color: #5a5a5a;">
                    <div class="card mb-4 box-shadow">
                        <img class="card-img-top" src="{{ imagen_id.imagen.url }}" style="height: 225px; width: 100%; display: block;" data-holder-rendered="true">                            
                        <div class="card-body">                           
                            <div class="d-flex justify-content-between align-items-center">                               
                               <button type="button" class="btn btn-danger"  data-bs-toggle="tooltip" data-bs-placement="bottom" title="eliminar imagen"> <i class="bi bi-trash3"></i></button>
                                <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckChecked" checked>
                                <label class="form-check-label" for="flexSwitchCheckChecked"></label>
                                </div>
                            </div>
                           
                        </div>                
                    </div>                
                    </a>
                    </div>            
                {% endfor %}                   
                </div>
            </div>                       
        </div>        
    {% endif %}
    <div class="card mt-2">
        <div class="row">
            <div class="form-actions" align="center">
                <button type="submit" class="col-md-1 btn btn-success" name="comando" value="guardar">Guardar</button>
                <a href="{% url 'administracion:producto_list' %}">
                    <button type="button" class="col-md-1 btn btn-secondary">Volver</button>              
                </a>                            
                {% if  form.instance.id %}
                    <button type="button" class="col-md-1 btn btn-danger" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                        Eliminar
                    </button> 
                {% endif %}     
            </div>                                                                  
        </div>                
    </div>           
</form>
 {% comment %} Modal añadir imagen  {% endcomment %}
 {% if form.instance.id %}   
<form  method="post" class="form-floating" action="{% url 'administracion:subir_imagen' key_producto=form.instance.id %}" enctype="multipart/form-data">    
    <div class="modal fade" id="addImagen" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="staticBackdropLabel">Añadir Imagen</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <input type="hidden" name="secure_data" value="{{secure_data}}"/>  
            {% csrf_token %}
            {{form_imagen.imagen}}        
            
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" class="btn btn-primary">Guardar</button>
        </div>
        </div>
    </div>
    </div>
</form>    
{% endif %}

  <!-- Modal -->
  <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="staticBackdropLabel">Eliminar Producto: {{form.instance.id}}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form  method="post" class="form-floating" actions="{% url 'administracion:producto_edit' key=form.instance.id %}">   
            {% csrf_token %} 
            <input type="hidden" name="secure_data" value="{{secure_data}}"/>      
            <div class="modal-body">            
                {{form.instance.nombre}}- marca: {{form.instance.marca_id}}-para: {{form.instance.subcategoria_id}}
            </div>        
            <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>         
            <button type="submit" class="btn btn-danger" name="comando" value="eliminar">Confirmar</button>            
            </div>
        </form>
      </div>
    </div>
  </div>

{% endblock content %}
{% block script %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="{% static 'administracion/js/select-ajax.js' %}"></script>
{% endblock script %}
  
  
  

  